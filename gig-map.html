---
title: Every gig we've ever played
---

<div id='gig-map' class='gig-map rounded'></div>

<script>
  map = L.map('gig-map').setView(
    [
      51.50979,
      -0.13204
    ],
    11
  );

  L.tileLayer('//stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
  	subdomains: 'abcd',
  	minZoom: 1,
  	maxZoom: 20,
  	ext: 'png'
  }).addTo(map)

  L.tileLayer('//stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}.{ext}', {
    attribution: `
      Map tiles by <a href="http://stamen.com">Stamen Design</a>,
      <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>
      <br />
      Map data &copy;
      <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> |
      <a href='//www.openstreetmap.org/?mlat={{ include.latitude }}&amp;mlon={{ include.longitude }}#map=16/{{ include.latitude }}/{{ page.longitude }}'>View larger map</a>
    `,
    subdomains: 'abcd',
    minZoom: 1,
    maxZoom: 20,
    ext: 'png'
  }).addTo(map)

  $.ajax({
    headers: {
      Accept: 'application/vnd.geo+json'
    },
    url: 'http://data.rawfunkmaharishi.uk/gigs',
    dataType: 'json'
  }).done(function(data) {
    L.geoJson(data, {
      onEachFeature: onEachFeature
    }).addTo(map)
  })

  function onEachFeature(feature, layer) {
    s = '<div class="gig-popup">'
    s += feature.properties.name
    s += '<hr />'

    $.each(feature.properties.gigs, function(index, gig) {
      s += '<a href="' + gig.url + '">'
      s += moment(gig.date).format('Do MMMM YYYY')
      s += '</a>'
      s += '<br />'
    })

    s += '</div>'

    layer.bindPopup(s)
  }
</script>
